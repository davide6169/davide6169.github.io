<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<meta name="description" content="an open source UNIX framework for shell script based web service provider" />
<meta name="keywords" content="mysvc, shell script, web service, provider, service, soa, template, engine, myste, mysde, mysvcd" />
<link rel="stylesheet" href="../xhtml11.css" type="text/css" />
<link rel="stylesheet" href="../xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="../layout1.css" type="text/css" />
<title>MySVC</title>
</head>
<body>
<div id="layout-banner">
  <div id="layout-title">MySVC</div>
  <div id="layout-description">an open source UNIX framework for shell script based web services provider</div>
</div>
<table>
<tr valign="top">
<td id="layout-menu">
  <div>&#187;<a href="../index.html">Home</a></div>
  <div>&#187;<a href="../tools.html">Tools</a></div>
  <div>&#187;<a href="../manpage.html">Man&nbsp;Page</a></div>
  <div>&#187;<a href="../userguide.html">User&nbsp;Guide</a></div>
  <div>&#187;<a href="../changelog.html">ChangeLog</a></div>
  <div>&#187;<a href="../install.html">Installation</a></div>
  <div>&#187;<a href="../sourcecode.html">Source Code</a></div>
  <div>&#187;<a href="../downloads.html">Downloads</a></div>
  <div>&#187;<a href="../faq.html">FAQ</a></div>
  <div>&#187;<a href="../support.html">Support</a></div>
  <div>&#187;<a href="../license.html">License</a></div>
  <hr/>
  <div>&#187;<a href="../myapps/index.html">My Apps</a></div>
  <div>
  <hr/>
  <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
  <input type="hidden" name="cmd" value="_s-xclick">
  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
  ">
  <input type="image" src="https://www.paypal.com/en_US/IT/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="">
  <img alt="" border="0" src="https://www.paypal.com/it_IT/i/scr/pixel.gif" width="1" height="1">
  </form>
  </div>
</td>
<td>
<div id="layout-content">
<div id="header">
<h1>MySVCD Source Code</h1>
</div>
<h2 id="_stp">stp</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre><tt>#!/bin/sh
#\
exec expect "$0" -- ${1+"$@"}

# #######################################################################
#
#  ###   ##        ### ##  ##  ####
#   ##  ##        #  #  #  ## ##  #
#   ### ##  ##  # ###   #  #  #
#   # ## #   # ##   ##   # #  #
#   # #  #   # #  #  #   ##   ##
#  ###  ###   ##  ###     #    ####
#             #
#            #
#
#  My Service
#
# #######################################################################
#
#  Client Example used in BLU as driver for STP Network Elements for MNP
#
# #######################################################################
#
# Script: stp - STP driver
#
# Version: 1.0
#
# Date: 15/10/2002
#
# Author: Davide Cucciniello
#
# Usage:
#   stp [-h &lt;host&gt;]
#       [-p &lt;port&gt;]
#       [-U &lt;username&gt;]
#       [-P &lt;password&gt;]
#       [-T &lt;timeout&gt;]
#       [-t &lt;subscribertype=mr|mp|mi|mn|fp&gt;]
#       [-m &lt;subscribernumber=393xyzzzzzzz[-393xyzzzzzzz]&gt;]
#       [-r &lt;routingnumber&gt;]
#       [-q]
#       [-a]
#       [-c]
#       [-d]
#       [-I]
#       [-O]
#       [-L]
#       [-A]
#       [-1]
#       [-2]
#       [-k]
#       [-D]
#       [-l]
#       [-i]
#       [-u]
#
#     -q =&gt; display np entry
#     -a =&gt; assign np entry
#     -c =&gt; change np entry
#     -d =&gt; delete np entry
#     -I =&gt; login (only)
#     -O =&gt; logout (only)
#     -L =&gt; login (,command) and logout
#     -A =&gt; abort (only)
#     -k =&gt; lock
#     -D =&gt; trace
#     -l =&gt; log
#     -i =&gt; debug
#     -u =&gt; usage
#
#   default:
#     &lt;host&gt; = 10.133.224.115
#     &lt;port&gt; = 2099
#     &lt;username&gt; = DSC
#     &lt;password&gt; = GMBH$3
#     &lt;timeout&gt; = 120
#     &lt;subscribertype&gt; = ALL
#     &lt;subscribernumber&gt; = ALL
#     &lt;routingnumber&gt; = 322
#
# Output:
#   &lt;exit status&gt; = 0 (ok) | 1 (error)
#
# Description:
#   Handle STP provisioning for MNP
#
# #######################################################################

proc usage {} {
  send_error "stp - STP driver - Ver. 1.0\n"
  send_error "\n"
  send_error "usage: stp \[-h &lt;host&gt;]\n"
  send_error "           \[-p &lt;port&gt;]\n"
  send_error "           \[-U &lt;username&gt;]\n"
  send_error "           \[-P &lt;password&gt;]\n"
  send_error "           \[-T &lt;timeout&gt;]\n"
  send_error "           \[-t &lt;subscribertype=mr|mp|mi|mn|fp&gt;]\n"
  send_error "           \[-m &lt;subscribernumber=393xyzzzzzzz\[-393xyzzzzzzz]&gt;]\n"
  send_error "           \[-r &lt;routingnumber&gt;]\n"
  send_error "           \[-q]\n"
  send_error "           \[-a]\n"
  send_error "           \[-c]\n"
  send_error "           \[-d]\n"
  send_error "           \[-I]\n"
  send_error "           \[-O]\n"
  send_error "           \[-L]\n"
  send_error "           \[-A]\n"
  send_error "           \[-1]\n"
  send_error "           \[-2]\n"
  send_error "           \[-k]\n"
  send_error "           \[-D]\n"
  send_error "           \[-l]\n"
  send_error "           \[-i]\n"
  send_error "\n"
  send_error "  -q =&gt; display np entry\n"
  send_error "  -a =&gt; assign np entry\n"
  send_error "  -c =&gt; change np entry\n"
  send_error "  -d =&gt; delete np entry\n"
  send_error "  -I =&gt; login\n"
  send_error "  -O =&gt; logout\n"
  send_error "  -L =&gt; login and logout\n"
  send_error "  -A =&gt; abort\n"
  send_error "  -1 =&gt; first stp\n"
  send_error "  -2 =&gt; second stp\n"
  send_error "  -k =&gt; lock\n"
  send_error "  -D =&gt; trace\n"
  send_error "  -l =&gt; log\n"
  send_error "  -i =&gt; debug\n"
  send_error "\n"
  send_error "  examples:\n"
  send_error "    stp -I\n"
  send_error "    stp -q -t fp -m 393xyzzzzzzz\n"
  send_error "    stp -a -t mi -m 393xyzzzzzzz -r xyz -1\n"
  send_error "    stp -c -t fp -m 393xyzzzzzzz -r xyz -1\n"
  send_error "    stp -d -t mr -m 393xyzzzzzzz-393xyzzzzzzz -2\n"
  send_error "    stp -O\n"

  exit 1
}

proc setDefaultValues {} {
  global parameter

  set parameter(subscribertype) "ALL"
  set parameter(subscribernumber) "ALL"
  set parameter(routingnumber) "322"
  set parameter(command) "null"
  set parameter(timeout) 120
  set parameter(log) 0
  set parameter(lock) 0
  set parameter(tmpdir) "/tmp"
  set parameter(lockfile) "stp.lock"

  # Test-plan STP (default)
  set parameter(host) "10.133.224.115"
  set parameter(port) "2099"
  set parameter(username) "DSC"
  set parameter(password) "GMBH\$3"

  # First STP
  set parameter(host,1) "10.133.224.252"
  set parameter(port,1) "2099"
  set parameter(username,1) "it"
  set parameter(password,1) "itprovi\$2"
  # set parameter(username,1) "NSSHQ"
  # set parameter(password,1) "RMHQ\$2"

  # Second STP
  set parameter(host,2) "10.133.5.92"
  set parameter(port,2) "2099"
  set parameter(username,2) "it"
  set parameter(password,2) "itprovi\$2"
  # set parameter(username,2) "NSSHQ"
  # set parameter(password,2) "RMHQ\$2"

  set parameter(loginandlogout) 0

  set parameter(status,print) 1
  set parameter(status,exit) 0

  log_user 0
}

proc parseArguments {} {
  global argv parameter

  set state flag

  foreach arg $argv {
    switch -- $state {
      flag {
        switch -regexp -- $arg {
          {-h.*} {set state host}
          {-p.*} {set state port}
          {-U.*} {set state username}
          {-P.*} {set state password}
          {-m.*} {set state subscribernumber}
          {-t.*} {set state subscribertype}
          {-r.*} {set state routingnumber}
          {-T.*} {set state timeout}
          {-q.*} {set parameter(command) display_np_entry}
          {-a.*} {set parameter(command) assign_np_entry}
          {-c.*} {set parameter(command) change_np_entry}
          {-d.*} {set parameter(command) delete_np_entry}
          {-I.*} {set parameter(command) login}
          {-O.*} {set parameter(command) logout}
          {-A.*} {set parameter(command) abort}
          {-L.*} {set parameter(loginandlogout) 1}
          {-1.*} {
            set parameter(host) $parameter(host,1)
            set parameter(port) $parameter(port,1)
            set parameter(username) $parameter(username,1)
            set parameter(password) $parameter(password,1)
          }
          {-2.*} {
            set parameter(host) $parameter(host,2)
            set parameter(port) $parameter(port,2)
            set parameter(username) $parameter(username,2)
            set parameter(password) $parameter(password,2)
          }
          {-k.*} {set parameter(lock) 1}
          {-D.*} {log_user 1}
          {-l.*} {set parameter(log) 1}
          {-i.*} {exp_internal 1}
          {-u.*} {usage}
        }
      }
      host {
        set parameter(host) $arg
        set state flag
      }
      port {
        set parameter(port) $arg
        set state flag
      }
      username {
        set parameter(username) $arg
        set state flag
      }
      password {
        set parameter(password) $arg
        set state flag
      }
      subscribernumber {
        set parameter(subscribernumber) $arg
        set state flag
      }
      subscribertype {
        set parameter(subscribertype) $arg
        set state flag
      }
      routingnumber {
        set parameter(routingnumber) $arg
        set state flag
      }
      timeout {
        set parameter(timeout) $arg
        set state flag
      }
    }
  }
}

proc checkParameters {} {
  global parameter

  if {![info exists parameter(subscribernumber)]} {
    usage
  }

  # remove "39" from subscriber number(s)

  regsub -- "^39" $parameter(subscribernumber) "" parameter(subscribernumber)
  regsub -- "-39" $parameter(subscribernumber) "-" parameter(subscribernumber)

  # uppercase subscriber type

  set parameter(subscribertype) [string toupper $parameter(subscribertype)]
}

proc log {level text} {
  global parameter

  # level:
  #   I =&gt; informational
  #   W =&gt; warning
  #   E =&gt; error
  #   F =&gt; fatal

  set timestamp [clock format \
    [clock seconds] -format "%Y%m%d %H%M%S"]

  if [string compare $level "I"] {
    send_error "$timestamp $level $text\n"
  } else {
    if $parameter(log) {
      send_user "$timestamp $level $text\n"
    }
  }
}

proc handleStp {} {
  global parameter

  if {![info exists parameter(username)] || \
      ![info exists parameter(password)]} {
    log F "username and password required"

    exit 1
  }

  if [catch {
    if $parameter(lock) {
      # check for lock file ...

      if [info exists parameter(tmpdir)] {
        if [file exists [file join $parameter(tmpdir) \
            $parameter(lockfile)]] {
          log F "Lock file found"

          exit 1
        } else {
          # remove lock file on exit ...

          exit -onexit {
            if [catch "file delete -force [file join $parameter(tmpdir) \
                $parameter(lockfile)]"] {
              log F "Error removing lock file"

              exit 1
            }
          }

          # create lock file ...

          if [catch "open [file join $parameter(tmpdir) \
              $parameter(lockfile)] w"] {
            log F "Error creating lock file"

            exit 1
          }
        }
      } else {
        if [file exists [file join [pwd] \
            $parameter(lockfile)]] {
          log F "Lock file found"

          exit 1
        } else {
          # remove lock file on exit ...

          exit -onexit {
            if [catch "file delete -force [file join [pwd] \
                $parameter(lockfile)]"] {
              log F "Error removing lock file"

              exit 1
            }
          }

          # create lock file ...

          if [catch "open [file join [pwd] \
              $parameter(lockfile)] w"] {
            log F "Error creating lock file"

            exit 1
          }
        }
      }
    }

    # open stp connection ...

    log I "Start \[[pid]]"

    log I "Opening connection with STP"
    log I "Server: '$parameter(host):$parameter(port)'"

    spawn telnet $parameter(host) $parameter(port)

    if ![string compare $parameter(command) "login"] {
      log I "Executing login"
      log I "Username: '$parameter(username)'"
      log I "Password: '$parameter(password)'"

      send "LOGIN\n"

      expect {
        -nocase "OR ALL:" {
          send [binary format H2 01]\r
          exp_continue
        }
        -nocase "ALLOWED" {
          send [binary format H2 01]\r
          exp_continue
        }
        -nocase "USERNAME:~" {
          send "$parameter(username)\r"
          exp_continue
        }
        -nocase "PASSWORD:~" {
          send "$parameter(password)\r"
          exp_continue
        }
        -nocase "USER AUTHORIZATION ERROR" {
          log F "Login incorrect"

          close

          exit 2
        }
        -nocase "OTHER USER ALREADY LOGGED IN" {
          log F "Other user already logged in"

          close
          exit 0
        }
        timeout {
          log F "Timeout"

          close

          exit 1
        }
        "&gt;"
      }

      log I "Login successfull"

      close

      exit 0
    }

    if ![string compare $parameter(command) "logout"] {
      log I "Executing abort"

      send [binary format H2 01]\r
      expect "&gt;"

      log I "Abort successfull"

      log I "Executing logout"

      send "LOGOUT\r"
      while 1 {
        expect {
          -nocase "USER NOT LOGGED IN" {
            log I "User not logged in"
            break
           }
          -nocase "LOGOUT COMPLETE" {
            break
          }
        }
      }

      log I "Logout successfull"

      # close connection ...

      log I "Closing connection with STP"

      close

      log I "Stop \[[pid]]"

      exit 0
    }

    if ![string compare $parameter(command) "abort"] {
      log I "Executing abort"

      send [binary format H2 01]\r
      expect "&gt;"

      log I "Abort successfull"

      # close connection ...

      log I "Closing connection with STP"

      close

      log I "Stop \[[pid]]"

      exit 0
    }

    if $parameter(loginandlogout) {
      # login ...

      log I "Executing login"
      log I "Username: '$parameter(username)'"
      log I "Password: '$parameter(password)'"

      send "LOGIN\n"

      expect {
        -nocase "OR ALL:" {
          send [binary format H2 01]\r
          exp_continue
        }
        -nocase "ALLOWED" {
          send [binary format H2 01]\r
          exp_continue
        }
        -nocase "USERNAME:~" {
          send "$parameter(username)\r"
          exp_continue
        }
        -nocase "PASSWORD:~" {
          send "$parameter(password)\r"
          exp_continue
        }
        -nocase "USER AUTHORIZATION ERROR" {
          log F "Login incorrect"

          close

          exit 2
        }
        -nocase "OTHER USER ALREADY LOGGED IN" {
          log F "Other user already logged in"

          close

          exit 3
        }
        timeout {
          log F "Timeout"

          close

          exit 1
        }
        "&gt;"
      }

      log I "Login successfull"
    }

    # execute command

    if ![string compare $parameter(command) "assign_np_entry"] {
      # ---------------
      # ASSIGN NP ENTRY
      # ---------------

      log I "Executing command 'ASSIGN NP ENTRY'"
      log I "Subscriber type: '$parameter(subscribertype)'"
      log I "Subscriber number: '$parameter(subscribernumber)'"
      log I "Routing number: '$parameter(routingnumber)'"

      send "ASSIGN NP ENTRY\r"

      while 1 {
        expect {
          -nocase "UPDATED"  {
            break
          }
          -nocase "ALREADY"  {
            # ... "THIS RANGE IS ALREADY IN THE DATABASE" ...
            set parameter(status,exit) 4

            break
          }
          -nocase "OR ABORT" {
            send "Y\r"
            exp_continue
          }
          -nocase "OF DIGITS" {
            send "Y\r"
            exp_continue
          }
          -nocase "ALLOWED" {
            send "Y\r"
            exp_continue
          }
          -nocase "SUBSCRIBER TYPE=~" {
            send "$parameter(subscribertype)\r"
            exp_continue
          }
          -nocase "SUBSCRIBER NUMBER=~" {
            send "$parameter(subscribernumber)\r"
            exp_continue
          }
          -nocase "ROUTING NUMBER=~" {
            send "$parameter(routingnumber)\r"
            exp_continue
          }
          -nocase "SAME NUMBER OF DIGITS" {
            send "$parameter(subscribernumber)\r"
            exp_continue
          }
          timeout {
            log F "Timeout"

            close

            exit 1
          }
        }
      }

      log I "Command successfull"

      log I "Executing abort"

      send [binary format H2 01]\r
      expect "&gt;"

      log I "Abort successfull"
    } elseif ![string compare $parameter(command) "change_np_entry"] {
      # ---------------
      # CHANGE NP ENTRY
      # ---------------

      log I "Executing command 'CHANGE NP ENTRY'"
      log I "Subscriber type: '$parameter(subscribertype)'"
      log I "Subscriber number: '$parameter(subscribernumber)'"
      log I "Routing number: '$parameter(routingnumber)'"

      send "CHANGE NP ENTRY\r"

      while 1 {
        expect {
          -nocase "UPDATED"  {
            break
          }
          -nocase "ALREADY"  {
            # ... "THIS RANGE IS ALREADY IN THE DATABASE" ...
            set parameter(status,exit) 4

            break
          }
          -nocase "OR ABORT" {
            send "Y\r"
            exp_continue
          }
          -nocase "OF DIGITS" {
            send "Y\r"
            exp_continue
          }
          -nocase "ALLOWED" {
            send "Y\r"
            exp_continue
          }
          -nocase "SUBSCRIBER TYPE=~" {
            send "$parameter(subscribertype)\r"
            exp_continue
          }
          -nocase "SUBSCRIBER NUMBER=~" {
            send "$parameter(subscribernumber)\r"
            exp_continue
          }
          -nocase "ROUTING NUMBER=~" {
            send "$parameter(routingnumber)\r"
            exp_continue
          }
          -nocase "SAME NUMBER OF DIGITS" {
            send "$parameter(subscribernumber)\r"
            exp_continue
          }
          timeout {
            log F "Timeout"

            close

            exit 1
          }
        }
      }

      log I "Command successfull"

      log I "Executing abort"

      send [binary format H2 01]\r
      expect "&gt;"

      log I "Abort successfull"
    } elseif ![string compare $parameter(command) "delete_np_entry"] {
      # ---------------
      # DELETE NP ENTRY
      # ---------------

      log I "Executing command 'DELETE NP ENTRY'"
      log I "Subscriber number: '$parameter(subscribernumber)'"

      send "DELETE NP ENTRY\r"

      while 1 {
        expect {
          -nocase "UPDATED"  {
            break
          }
          -nocase "OR ABORT" {
            send "Y\r"
            exp_continue
          }
          -nocase "ALLOWED" {
            send "Y\r"
            exp_continue
          }
          -nocase "SUBSCRIBER NUMBER=~" {
            send "$parameter(subscribernumber)\r"
            exp_continue
          }
          -nocase "SAME NUMBER OF DIGITS" {
            send "$parameter(subscribernumber)\r"
            exp_continue
          }
          -nocase "IS NOT IN THE DATABASE" {
            log I "Not found"

            close

            exit 5
          }
          timeout {
            log F "Timeout"

            close

            exit 1
          }
        }
      }

      log I "Command successfull"

      log I "Executing abort"

      send [binary format H2 01]\r
      expect "&gt;"

      log I "Abort successfull"
    } elseif ![string compare $parameter(command) "display_np_entry"] {
      # ----------------
      # DISPLAY NP ENTRY
      # ----------------

      set parameter(status,print) 0

      log I "Executing command 'DISPLAY NP ENTRY'"
      log I "Subscriber type: '$parameter(subscribertype)'"
      log I "Subscriber number: '$parameter(subscribernumber)'"

      send "DISPLAY NP ENTRY\r"

      while 1 {
        expect {
          -nocase "SUBSCRIBER TYPE=~" {
            send "$parameter(subscribertype)\r"
            log I "Sended subscriber type"
            exp_continue
          }
          -nocase "SUBSCRIBER NUMBER=~" {
            send "$parameter(subscribernumber)\r"
            log I "Sended subscriber number"
            break
          }
          -nocase "USER NOT LOGGED IN" {
            log F "User not logged in"

            close

            exit 4
          }
          -nocase "NOT AN OPTIONAL" {
            log F "Subscriber number expected"

            close

            exit 4
          }
          -nocase "ALLOWED" {
            log F "Subscriber type expected"

            close

            exit 4
          }
          -nocase "UNABLE TO INITIALIZE" {
            log F "Unable to initialize"

            close

            exit 4
          }
          timeout {
            log F "Timeout"

            close

            exit 1
          }
        }
      }

      while 1 {
        expect {
          -re "(\[^\r]*)\r\n" {
            if [regexp {SUCCESS} "$expect_out(1,string)" ] {
              break
            }
            if [regexp {COMPLETED} "$expect_out(1,string)" ] {
              break
            }
            if [regexp {ENTER SUBSCRIBER TYPE} "$expect_out(1,string)" ] {
              break
            }
            if [regexp {^ +[0-9]} "$expect_out(1,string)" ] {
              set startrange "39"
              append startrange [lindex "$expect_out(1,string)" 0]
              set endrange "39"
              append endrange [lindex "$expect_out(1,string)" 1]
              set subscribertype [lindex "$expect_out(1,string)" 2]
              set routingcode [lindex "$expect_out(1,string)" 3]

              send_user -- "$startrange $endrange $subscribertype $routingcode\n"

              exp_continue
            } else {
              exp_continue
            }
          }
          timeout {
            log F "Timeout"

            close

            exit 1
          }
        }
      }

      log I "Command successfull"

      log I "Executing abort"

      send [binary format H2 01]\r

      expect {
        -nocase "&gt;"
      }

      log I "Abort successfull"
    } elseif [string compare $parameter(command) "null"] {
      # unsupported command ...

      log F "Unsupported command"

      log I "Closing stp connection"

      # close connection ...

      send "LOGOUT\r"
      expect {
        -nocase "LOGOUT COMPLETE"
      }

      close

      exit 1
    }

    if $parameter(loginandlogout) {
      log I "Executing logout"

      # logout ...

      send "LOGOUT\r"
      expect {
        -nocase "LOGOUT COMPLETE"
      }

      log I "Logout successfull"
    }

    # close connection ...

    log I "Closing connection with STP"

    close

    log I "Stop \[[pid]]"

    exit $parameter(status,exit)

    # end
  } error] {
    log F "Internal error"

    exit 1
  }
}

# main

proc main {} {
  global argc

  if !$argc {
    usage
  }

  # set default values ...
  setDefaultValues

  # parse arguments ...
  parseArguments

  # check parameters ...
  checkParameters

  # handle ftp ...
  handleStp

  exit 0
}

main

# End of script</tt></pre>
</div></div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.400<br />
Last updated 2014-06-28 16:24:10 CEST
</div>
<div id="footer-badges">
<img style="border:none; width:88px; height:31px;"
     src="../images/gplv3-127x51.png"
     alt="GPL Version 3" />
<!-- Histats.com  START  -->
<a href="http://www.histats.com" target="_blank" title="simple hit counter" >
<script  type="text/javascript" language="javascript">
var s_sid = 675659;var st_dominio = 4;
var cimg = 0;var cwi =112;var che =48;
</script></a><script  type="text/javascript" language="javascript" src="http://s10.histats.com/js9.js"></script>
<noscript><a href="http://www.histats.com" target="_blank">
<img  src="http://s4.histats.com/stats/0.gif?675659&1" alt="simple hit counter" border="0"></a>
</noscript>
<!-- Histats.com  END  -->
</div>
</div>
</div>
</td>
</tr>
</table>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-11334618-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
