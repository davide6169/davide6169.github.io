<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<meta name="description" content="an open source UNIX framework for shell script based web service provider" />
<meta name="keywords" content="mysvc, shell script, web service, provider, service, soa, template, engine, myste, mysde, mysvcd" />
<link rel="stylesheet" href="../xhtml11.css" type="text/css" />
<link rel="stylesheet" href="../xhtml11-quirks.css" type="text/css" />
<link rel="stylesheet" href="../layout1.css" type="text/css" />
<title>MySVC</title>
</head>
<body>
<div id="layout-banner">
  <div id="layout-title">MySVC</div>
  <div id="layout-description">an open source UNIX framework for shell script based web services provider</div>
</div>
<table>
<tr valign="top">
<td id="layout-menu">
  <div>&#187;<a href="../index.html">Home</a></div>
  <div>&#187;<a href="../tools.html">Tools</a></div>
  <div>&#187;<a href="../manpage.html">Man&nbsp;Page</a></div>
  <div>&#187;<a href="../userguide.html">User&nbsp;Guide</a></div>
  <div>&#187;<a href="../changelog.html">ChangeLog</a></div>
  <div>&#187;<a href="../install.html">Installation</a></div>
  <div>&#187;<a href="../sourcecode.html">Source Code</a></div>
  <div>&#187;<a href="../downloads.html">Downloads</a></div>
  <div>&#187;<a href="../faq.html">FAQ</a></div>
  <div>&#187;<a href="../support.html">Support</a></div>
  <div>&#187;<a href="../license.html">License</a></div>
  <hr/>
  <div>&#187;<a href="../myapps/index.html">My Apps</a></div>
  <div>
  <hr/>
  <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
  <input type="hidden" name="cmd" value="_s-xclick">
  <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----MIIHPwYJKoZIhvcNAQcEoIIHMDCCBywCAQExggEwMIIBLAIBADCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwDQYJKoZIhvcNAQEBBQAEgYAWiqN5fcvDviZYNLmeRPAOeH+059PTyUtOFN8++Bx9+RhWYfjY/XwEwfKVwaEeK0+pLj9TDs/FW9ChZZF3FNPjR1Xlg0E3S37taxsarZ2NM6iBhXjSapQPgVGtrCqibd0Diq48ouQTcXPMxKON1Anv/fDoHjjaFPTRVI+KMQX0JTELMAkGBSsOAwIaBQAwgbwGCSqGSIb3DQEHATAUBggqhkiG9w0DBwQInBnxX7TxZ3mAgZhXvGov9cuq17ycIBz4CjE/MwjHddefpVXoPyyh89d/ieP1b6rehpp1R/aW8QBbnS1Fl/INzPU38Y3NTqX7oMhFYsLN1D6YSPjAeoFqIXp1rrTEIDLZRSSIwo8OXuEsPHqK/P+l7S4awyCyWJxdMkqSDK2hPoKXSUHIGA8jf6Rq4DV0CsJzljLJSW8WJMfdpXvKuff4HiEZPaCCA4cwggODMIIC7KADAgECAgEAMA0GCSqGSIb3DQEBBQUAMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbTAeFw0wNDAyMTMxMDEzMTVaFw0zNTAyMTMxMDEzMTVaMIGOMQswCQYDVQQGEwJVUzELMAkGA1UECBMCQ0ExFjAUBgNVBAcTDU1vdW50YWluIFZpZXcxFDASBgNVBAoTC1BheVBhbCBJbmMuMRMwEQYDVQQLFApsaXZlX2NlcnRzMREwDwYDVQQDFAhsaXZlX2FwaTEcMBoGCSqGSIb3DQEJARYNcmVAcGF5cGFsLmNvbTCBnzANBgkqhkiG9w0BAQEFAAOBjQAwgYkCgYEAwUdO3fxEzEtcnI7ZKZL412XvZPugoni7i7D7prCe0AtaHTc97CYgm7NsAtJyxNLixmhLV8pyIEaiHXWAh8fPKW+R017+EmXrr9EaquPmsVvTywAAE1PMNOKqo2kl4Gxiz9zZqIajOm1fZGWcGS0f5JQ2kBqNbvbg2/Za+GJ/qwUCAwEAAaOB7jCB6zAdBgNVHQ4EFgQUlp98u8ZvF71ZP1LXChvsENZklGswgbsGA1UdIwSBszCBsIAUlp98u8ZvF71ZP1LXChvsENZklGuhgZSkgZEwgY4xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJDQTEWMBQGA1UEBxMNTW91bnRhaW4gVmlldzEUMBIGA1UEChMLUGF5UGFsIEluYy4xEzARBgNVBAsUCmxpdmVfY2VydHMxETAPBgNVBAMUCGxpdmVfYXBpMRwwGgYJKoZIhvcNAQkBFg1yZUBwYXlwYWwuY29tggEAMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQADgYEAgV86VpqAWuXvX6Oro4qJ1tYVIT5DgWpE692Ag422H7yRIr/9j/iKG4Thia/Oflx4TdL+IFJBAyPK9v6zZNZtBgPBynXb048hsP16l2vi0k5Q2JKiPDsEfBhGI+HnxLXEaUWAcVfCsQFvd2A1sxRr67ip5y2wwBelUecP3AjJ+YcxggGaMIIBlgIBATCBlDCBjjELMAkGA1UEBhMCVVMxCzAJBgNVBAgTAkNBMRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRQwEgYDVQQKEwtQYXlQYWwgSW5jLjETMBEGA1UECxQKbGl2ZV9jZXJ0czERMA8GA1UEAxQIbGl2ZV9hcGkxHDAaBgkqhkiG9w0BCQEWDXJlQHBheXBhbC5jb20CAQAwCQYFKw4DAhoFAKBdMBgGCSqGSIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTA4MTAyNTE1NTQzMlowIwYJKoZIhvcNAQkEMRYEFMsXBheWWoPdxAigpR2+KpSpl3NXMA0GCSqGSIb3DQEBAQUABIGAMwKAzwiLVvhRLUQBUUgK5IJQOq4Ci0W9bVWiiCIF3g/DOWMzoJvlQRyxelM5jg2wChbtvg1sj5AoyXaqCdbuEI/7rP0/RhrfFxDqkSbWTOqkcgkMPgNeKvXAC9oD2Dflep/uDlUC2E0w9XEPtps7a5jCiJX5//huQ/usU3f5wmI=-----END PKCS7-----
  ">
  <input type="image" src="https://www.paypal.com/en_US/IT/i/btn/btn_donateCC_LG.gif" border="0" name="submit" alt="">
  <img alt="" border="0" src="https://www.paypal.com/it_IT/i/scr/pixel.gif" width="1" height="1">
  </form>
  </div>
</td>
<td>
<div id="layout-content">
<div id="header">
<h1>MySPL Source Code</h1>
</div>
<h2 id="_apt_cc">apt.cc</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre><tt>// $Id$

//  myspl - My Service Protocol Library - Version 1.0 (www.mysvc.it)
//  Copyright (C) 2009 Davide Cucciniello &lt;davide6169@gmail.com&gt;
//
//  This program is free software: you can redistribute it and/or modify
//  it under the terms of the GNU General Public License as published by
//  the Free Software Foundation, either version 3 of the License, or
//  (at your option) any later version.
//
//  This program is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//  GNU General Public License for more details.
//
//  You should have received a copy of the GNU General Public License
//  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

/* **********************************************************************
 *
 *  ***   **        *** **  **  ****
 *   **  **        *  *  *  ** **  *
 *   *** **  **  * ***   *  *  *
 *   * ** *   * **   **   * *  *
 *   * *  *   * *  *  *   **   **
 *  ***  ***   **  ***     *    ****
 *             *
 *            *
 *
 *  My Service
 *
 * ***********************************************************************
 *
 *  ***   **        *** ****  ***
 *   **  **        *  *  *  *  *
 *   *** **  **  * ***   *  *  *
 *   * ** *   * **   **  ***   *
 *   * *  *   * *  *  *  *     *  *
 *  ***  ***   **  ***  ***   *****
 *             *
 *            *
 *
 *  My Service Protocol Library Example Client
 *  (Ascii Protocol Tester)
 *
 *  File: apt.cc
 *
 *  Usage:
 *    apt [-a &lt;addr&gt;]
 *        [-p &lt;port&gt;]
 *        [-f &lt;inputfile&gt;]
 *        [-o &lt;outputfile&gt;]
 *        [-d &lt;delay&gt;]
 *
 *   (default input: stdin,
 *    default output: stdout)
 *
 *  Input:
 *      &lt;request_line&gt;
 *      &lt;request_line&gt;
 *      ...
 *      &lt;request_line&gt;
 *      %&lt;substring_of_last_response_line&gt;%
 *      &lt;request_line&gt;
 *      &lt;request_line&gt;
 *      ...
 *      &lt;request_line&gt;
 *      %&lt;substring_of_last_response_line&gt;%
 *
 *  Description:
 *    Simple Tester Client for ASCII Protocols
 *    (send to server request lines from input stream and
 *     write to output stream server response lines)
 *    as usage example for MySPL library
 *    (used to test many provisioning protocols on Network Elements
 *     in BLU mobile telephone operator)
 *
 *  Input Example:
 *
 *  AS4
 *  00
 *  SAS_ACTION LOGIN
 *  LOGIN blu2
 *  PASSWORD online
 *  $END$
 *  %$END$%
 *  SAS4
 *  00
 *  SAS_ACTION LOGOUT
 *  $END$
 *  %$END$%
 *
 * ***********************************************************************
 *
 *  History:
 *    1.0               first version
 *
 * *********************************************************************** */

#include "protocol.hh"
#include &lt;fstream&gt;

// Error codes

#define APT_INTERNAL_ERROR   1
#define APT_CONNECTION_ERROR 2
#define APT_INPUTFILE_ERROR  3
#define APT_OUTPUTFILE_ERROR 4
#define APT_SEND_ERROR       5
#define APT_RECV_ERROR       6

// Error messages

#define APT_SEND_MSGERROR     "error sending request"
#define APT_RECV_MSGERROR     "error receiving response"

// Constants

#define APT_MAXLINESIZE    1024

using namespace std;

//
// Main
//

int main(int argc,char* argv[])
{
  // Default values

  string inputfile = "";
  string outputfile = "";
  int delay = 0;
  string addr = "";
  int port = 0;

  bool delay_option_is_specified = false;

  // Parsing command line options

  int option;

  while((option = getopt(argc,argv,":ha:p:f:o:d:")) != EOF)
  {
    switch(option)
    {
      case 'h':
        cerr &lt;&lt; "usage: apt [-a &lt;addr&gt;]" &lt;&lt; endl;
        cerr &lt;&lt; "           [-p &lt;port&gt;]" &lt;&lt; endl;
        cerr &lt;&lt; "           [-f &lt;inputfile&gt;]" &lt;&lt; endl;
        cerr &lt;&lt; "           [-o &lt;outputfile&gt;]" &lt;&lt; endl;
        cerr &lt;&lt; "           [-d &lt;delay&gt;]" &lt;&lt; endl;
        cerr &lt;&lt; endl;

        return APT_INTERNAL_ERROR;
        break;
      case 'a':
        addr = optarg;
        break;
      case 'p':
        port = atoi(optarg);
        break;
      case 'f':
        inputfile = optarg;
        break;
      case 'o':
        outputfile = optarg;
        break;
      case 'd':
        delay = atoi(optarg);
        delay_option_is_specified = true;
        break;
    }
  }

  // If ip address or port is not specified try environment variables ...

  if(addr.empty() &amp;&amp; getenv("APT_ADDR"))
    addr = getenv("APT_ADDR");

  if(port == 0 &amp;&amp; getenv("APT_PORT"))
    port = atoi(getenv("APT_PORT"));

  // If APT_DELAY environment variable is defined use it ...

  if(!delay_option_is_specified &amp;&amp; getenv("APT_DELAY"))
    delay = atoi(getenv("APT_DELAY"));

  if(addr.empty() || port == 0)
  {
    // error ...

    cerr &lt;&lt; "apt - Ascii Protocol Tester - Ver 1.0" &lt;&lt; endl;
    cerr &lt;&lt; endl;
    cerr &lt;&lt; "usage: apt [-a &lt;addr&gt;]" &lt;&lt; endl;
    cerr &lt;&lt; "           [-p &lt;port&gt;]" &lt;&lt; endl;
    cerr &lt;&lt; "           [-f &lt;inputfile&gt;]" &lt;&lt; endl;
    cerr &lt;&lt; "           [-o &lt;outputfile&gt;]" &lt;&lt; endl;
    cerr &lt;&lt; "           [-d &lt;delay&gt;]" &lt;&lt; endl;
    cerr &lt;&lt; endl;
    cerr &lt;&lt; "  input:" &lt;&lt; endl;
    cerr &lt;&lt; "    &lt;request_line&gt;" &lt;&lt; endl;
    cerr &lt;&lt; "    &lt;request_line&gt;" &lt;&lt; endl;
    cerr &lt;&lt; "    ..." &lt;&lt; endl;
    cerr &lt;&lt; "    &lt;request_line&gt;" &lt;&lt; endl;
    cerr &lt;&lt; "    %&lt;substring_of_last_response_line&gt;%" &lt;&lt; endl;
    cerr &lt;&lt; "    &lt;request_line&gt;" &lt;&lt; endl;
    cerr &lt;&lt; "    &lt;request_line&gt;" &lt;&lt; endl;
    cerr &lt;&lt; "    ..." &lt;&lt; endl;
    cerr &lt;&lt; "    &lt;request_line&gt;" &lt;&lt; endl;
    cerr &lt;&lt; "    %&lt;substring_of_last_response_line&gt;%" &lt;&lt; endl;
    cerr &lt;&lt; "    ..." &lt;&lt; endl;

    return APT_INTERNAL_ERROR;
  }

  // if inputfile and outputfile are not specified
  // use standard input and standard output

  istream* inputstream;
  ostream* outputstream;

  if(inputfile.empty())
    inputstream = &amp;cin;
  else
  {
    inputstream = new ifstream(inputfile.c_str());

    if(!(*inputstream))
    {
      cerr &lt;&lt; "error: cannot open input file " &lt;&lt; inputfile &lt;&lt; endl;

      delete inputstream;

      return APT_INPUTFILE_ERROR;
    }
  }

  if(outputfile.empty())
    outputstream = &amp;cout;
  else
  {
    outputstream = new ofstream(outputfile.c_str());

    if(!(*outputstream))
    {
      cerr &lt;&lt; "error: cannot open output file " &lt;&lt; outputfile &lt;&lt; endl;

      delete outputstream;

      return APT_OUTPUTFILE_ERROR;
    }
  }

  try
  {
    // Connect to server (ascii mode) ...

    SocketClient client(addr,port,false);

    client.connect();

    StringField request;
    StringField response(APT_MAXLINESIZE);

    string requeststr;
    string responsestr;

    // input is a sequence of &lt;request_block&gt;;
    // each &lt;request_block&gt; has the following syntax:
    //
    // &lt;request_line&gt;
    // &lt;request_line&gt;
    // ...
    // &lt;request_line&gt;
    // %&lt;substring_of_last_response_line&gt;%
    //
    // Send request lines of input stream to server
    // and write response lines from server to output stream ...

    while(getline(*inputstream,requeststr))
    {
      if ((requeststr.length() &gt;= 2) &amp;&amp;
          (requeststr[0] == '%') &amp;&amp;
          (requeststr[requeststr.length()-1] == '%'))
      {
        string last;

        if(requeststr.length() &gt; 2)
          last = requeststr.substr(1,requeststr.length()-2);

        while(1)
        {
          try
          {
            // Reading response ...
            client &gt;&gt; response;

            responsestr = response.value();
          }
          catch(...)
          {
            cerr &lt;&lt; APT_RECV_MSGERROR &lt;&lt; endl;

            try
            {
              client.close();
            }
            catch(...)
            {
            }

            return APT_RECV_ERROR;
          }

          (*outputstream) &lt;&lt; responsestr &lt;&lt; endl;

          if(responsestr.find(last) != string::npos)
            break;
        }

        continue;
      }

      request = requeststr;

      try
      {
        // Sending request ...
        client &lt;&lt; request;
      }
      catch(...)
      {
        cerr &lt;&lt; APT_SEND_MSGERROR &lt;&lt; endl;

        try
        {
          client.close();
        }
        catch(...)
        {
        }

        return APT_SEND_ERROR;
      }
    }

    client.close();
  }
  catch(SocketException e)
  {
    cerr &lt;&lt; e &lt;&lt; endl;

    return APT_CONNECTION_ERROR;
  }
  catch(Exception e)
  {
    cerr &lt;&lt; e &lt;&lt; endl;

    return APT_INTERNAL_ERROR;
  }
  catch(exception e)
  {
    cerr &lt;&lt; "System exception" &lt;&lt; endl;
    cerr &lt;&lt; e.what() &lt;&lt; endl;

    return APT_INTERNAL_ERROR;
  }

  if(inputstream != &amp;cin)
  {
    ((ifstream*)inputstream)-&gt;close();
    delete inputstream;
  }

  if(outputstream != &amp;cout)
  {
    ((ofstream*)outputstream)-&gt;close();
    delete outputstream;
  }

  return 0;
}

/* end of file */</tt></pre>
</div></div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.400<br />
Last updated 2014-06-28 16:23:41 CEST
</div>
<div id="footer-badges">
<img style="border:none; width:88px; height:31px;"
     src="../images/gplv3-127x51.png"
     alt="GPL Version 3" />
<!-- Histats.com  START  -->
<a href="http://www.histats.com" target="_blank" title="simple hit counter" >
<script  type="text/javascript" language="javascript">
var s_sid = 675659;var st_dominio = 4;
var cimg = 0;var cwi =112;var che =48;
</script></a><script  type="text/javascript" language="javascript" src="http://s10.histats.com/js9.js"></script>
<noscript><a href="http://www.histats.com" target="_blank">
<img  src="http://s4.histats.com/stats/0.gif?675659&1" alt="simple hit counter" border="0"></a>
</noscript>
<!-- Histats.com  END  -->
</div>
</div>
</div>
</td>
</tr>
</table>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-11334618-1");
pageTracker._trackPageview();
} catch(err) {}</script>
</body>
</html>
